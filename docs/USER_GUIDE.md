# Smart-Ops-Term 使用指南

> **版本**: v1.6.1
> **更新日期**: 2026-01-20

---

## 📋 目录

1. [快速入门](#快速入门)
2. [界面介绍](#界面介绍)
3. [基本操作](#基本操作)
4. [AI 助手使用](#ai-助手使用)
5. [配置管理](#配置管理)
6. [多连接管理](#多连接管理)
7. [常见问题](#常见问题)
8. [技巧与窍门](#技巧与窍门)

---

## 🚀 快速入门

### 第一次使用

1. **启动应用**
   ```bash
   python src/main.py
   ```

2. **配置 AI**（首次使用必需）
   - 点击工具栏 **⚙️ Settings** 按钮
   - 在 **AI Settings** 标签页填写：
     - **API Key**: 你的 API 密钥
     - **API Base**: API 地址（如 `https://api.openai.com/v1`）
     - **Model**: 模型名称（如 `gpt-4-turbo`）
   - 点击 **OK** 保存

3. **连接 SSH**（可选）
   - 点击 **New Connection** 或按 `Ctrl+O`
   - 填写服务器信息：
     - **Host**: 服务器地址
     - **Port**: 端口（默认 22）
     - **Username**: 用户名
     - **Password**: 密码
   - 点击 **OK** 连接

4. **开始使用**
   - 在终端输入命令
   - 在右侧 AI 助手处提问
   - AI 会看到终端输出并给出建议

---

## 🖥️ 界面介绍

### 主窗口布局

```
┌─────────────────────────────────────────────────────┐
│ 工具栏: [New Connection] [⚙️ Settings] [Privacy]    │
├───────────────────┬─────────────────────────────────┤
│ 标签页 1 │ 标签页 2 │ 标签页 3 │                     │
├───────────────────┴─────────────────────────────────┤
│ ┌───────────────┐ ┌─────────────────────────────┐   │
│ │               │ │ AI Assistant                │   │
│ │   终端区域    │ │                             │   │
│ │   (Terminal)  │ │ 对话历史...                │   │
│ │               │ │                             │   │
│ │               │ │ [输入框...]           [Send]│   │
│ └───────────────┘ └─────────────────────────────┘   │
│ 状态栏: Connection: active | AI: ready              │
└─────────────────────────────────────────────────────┘
```

### 工具栏按钮

| 按钮 | 功能 | 快捷键 |
|------|------|--------|
| New Connection | 创建新 SSH 连接 | `Ctrl+O` |
| ⚙️ Settings | 打开设置对话框 | `Ctrl+,` |
| Privacy Mode | 隐私模式开关 | `Ctrl+P` |

---

## 🎯 基本操作

### 终端操作

**输入命令**:
- 直接在终端区域输入命令
- 按 `Enter` 执行
- 支持上下箭头浏览命令历史

**复制粘贴**:
- `Ctrl+Shift+C`: 复制选中文本
- `Ctrl+Shift+V`: 粘贴文本

**清屏**:
- `Ctrl+L`: 清空终端屏幕

**密码输入**:
- 当提示输入密码时（如 sudo），会自动弹出密码对话框
- 输入密码后自动继续执行

### AI 对话操作

**发送消息**:
- 在右侧输入框输入问题
- 按 `Enter` 发送
- `Shift+Enter`: 换行不发送

**执行 AI 建议的命令**:
- 点击 AI 回复中的 **Run Command** 按钮
- 命令会自动在终端中执行

**清空对话**:
- 右键点击对话区域
- 选择 **Clear Chat**

---

## 🤖 AI 助手使用

### 核心功能

**1. 自动分析命令结果**

```
终端输出: Permission denied

AI 自动分析:
你收到了 Permission denied 错误，这是因为该文件需要 root 权限。
解决方法：
sudo cat /etc/hosts
```

**2. 上下文感知**

AI 能够看到最近 500 行终端输出，了解当前工作状态。

**3. 多步骤自动化**

```
你: 检查磁盘使用情况，有问题就清理

AI: 好的，我先查看磁盘使用情况。
df -h
[Run Command]

(5秒后自动分析)
AI: 磁盘使用正常，最大的分区 / 使用了 45%。
是否需要查看大文件？
```

**4. 危险命令检测**

```
你: 删除所有日志

AI: ⚠️ 警告：此操作将删除所有日志文件，可能影响系统调试。
确定要执行吗？
```

### 最佳实践

**✅ 好的提问方式**:
- "帮我分析一下为什么 Nginx 启动失败"
- "检查系统资源占用，找出高内存进程"
- "优化 MySQL 配置，当前有 1000 个并发连接"

**❌ 避免的提问方式**:
- "帮我做 XXX"（没有具体要求）
- "为什么不行"（没有上下文）
- "快速搞定"（AI 需要分析）

---

## ⚙️ 配置管理

### 设置对话框

打开方式：点击 **⚙️ Settings** 按钮或按 `Ctrl+,`

#### AI Settings 标签页

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| API Key | API 密钥 | - |
| API Base | API 地址 | https://api.openai.com/v1 |
| Model | 模型名称 | gpt-4-turbo |
| Temperature | 创造性（0-2） | 0.7 |
| Max Tokens | 最大输出长度 | 3000 |
| Max History | 最大对话历史 | 15 |
| System Prompt | 系统提示词 | 默认提示词 |

#### Terminal 标签页

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| Font Family | 字体 | Consolas |
| Font Size | 字号 | 14 |
| Background Color | 背景色 | #1e1e1e |
| Text Color | 文字颜色 | #00ff00 |
| Cursor Blink | 光标闪烁 | ✅ |
| Scroll on Output | 输出时滚动 | ✅ |
| Max Lines | 最大行数 | 500 |

#### Interface 标签页

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| Window Width | 窗口宽度 | 1200 |
| Window Height | 窗口高度 | 700 |
| Show Toolbar | 显示工具栏 | ✅ |
| Show Statusbar | 显示状态栏 | ✅ |

#### Connection 标签页

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| Timeout | 连接超时（秒） | 10 |
| Auto Save History | 自动保存历史 | ✅ |
| Max History Count | 最大历史数 | 10 |

### 配置文件

**位置**: `~/.smartops/app_config.json`

**示例**:
```json
{
  "ai": {
    "api_key": "sk-your-key",
    "api_base": "https://api.openai.com/v1",
    "model": "gpt-4-turbo",
    "temperature": 0.7,
    "max_tokens": 3000
  },
  "terminal": {
    "font_family": "Consolas",
    "font_size": 14
  }
}
```

---

## 🔗 多连接管理

### 创建新连接

1. 点击工具栏 **New Connection** 按钮
2. 填写服务器信息
3. 点击 **OK** 连接
4. 新标签页自动创建并连接

### 切换连接

- 点击标签页切换不同连接
- 每个标签页有独立的：
  - 终端会话
  - AI 对话
  - 命令历史

### 关闭连接

- 点击标签页的 **×** 按钮
- SSH 连接自动断开
- AI 上下文自动清除

### 连接管理器

已保存的连接配置存储在 `~/.smartops/connections.json`：

```json
[
  {
    "name": "生产服务器",
    "host": "192.168.1.100",
    "port": 22,
    "username": "admin"
  }
]
```

---

## 🔒 隐私与安全

### 隐私模式

**作用**: 终端内容不发送给 AI

**使用场景**:
- 处理敏感数据（密码、密钥、IP）
- 执行保密操作
- 调试敏感问题

**启用方法**: 勾选工具栏的 **Privacy Mode** 复选框

### 凭证管理

- **密码**: 仅在运行时使用，不持久化存储
- **API Key**: 存储在本地配置文件中
- **连接信息**: 加密存储在 `~/.smartops/connections.json`

### 数据传输

- 终端输出通过 **HTTPS** 发送到 AI API
- 对话历史仅在 **内存** 中，退出后清除

---

## ❓ 常见问题

### Q1: 配置没有保存？

**原因**: v1.6.0 的 bug

**解决**: 升级到 v1.6.1

**检查**:
```bash
# 检查配置文件
cat ~/.smartops/app_config.json

# 检查文件权限
ls -la ~/.smartops/
```

### Q2: AI 不响应？

**检查清单**:
1. API Key 是否正确
2. API Base 地址是否可访问
3. 网络连接是否正常
4. 模型名称是否正确

**调试方法**:
- 打开设置对话框，修改配置后点击 **Apply**
- 查看终端是否有错误信息

### Q3: SSH 连接失败？

**常见原因**:
- 主机地址或端口错误
- 用户名或密码错误
- 防火墙阻止连接
- SSH 服务未启动

**解决方法**:
1. 检查服务器地址和端口
2. 确认用户名密码正确
3. 尝试用其他 SSH 客户端连接
4. 检查服务器 SSH 服务状态

### Q4: 终端显示乱码？

**原因**: 字符编码问题

**解决**:
1. 在设置中修改终端字体
2. 确保服务器端 UTF-8 编码
3. 在 `.bashrc` 中添加：`export LANG=en_US.UTF-8`

### Q5: 应用启动慢？

**原因**: 正常的初始化过程

**优化**:
1. 减少终端最大行数（设置中调整）
2. 减少 AI 对话历史数
3. 使用更快的模型

---

## 💡 技巧与窍门

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+O` | 新建连接 |
| `Ctrl+,` | 打开设置 |
| `Ctrl+P` | 隐私模式 |
| `Ctrl+L` | 清空终端 |
| `Ctrl+Shift+C` | 复制 |
| `Ctrl+Shift+V` | 粘贴 |
| `Ctrl+Tab` | 下一个标签 |
| `Ctrl+Shift+Tab` | 上一个标签 |

### AI 提示词优化

**好的提示词**:
```
"检查 Nginx 配置文件语法错误，如果发现问题给出修复建议"
```

**不好的提示词**:
```
"Nginx 有问题"
```

### 批量操作

```
你: 帮我批量重命名这些文件：
file1.txt -> document_001.txt
file2.txt -> document_002.txt
file3.txt -> document_003.txt

AI: 可以使用以下命令：
for i in {1..3}; do
  mv file$i.txt document_00$i.txt
done
```

### 调试技巧

1. **逐步执行**: 让 AI 逐步分析问题
2. **查看日志**: 让 AI 帮助查看和分析日志
3. **性能分析**: 让 AI 帮助分析性能瓶颈

---

## 📞 获取帮助

- **文档**: [README.md](README.md)
- **问题反馈**: [GitHub Issues](https://github.com/orphiczhou/Smart-Ops-Term/issues)
- **开发记录**: [CHANGELOG.md](CHANGELOG.md)

---

**祝使用愉快！** 🎉
